# -*- coding: utf-8 -*-
#
# script made by Z
#



def ecrire(p): 
    fsortie.write ("// =============================//\n")
    fsortie.write ("// script generated by zas \n")
    fsortie.write ("// a Z tool\n")
    fsortie.write ("// z_arma@hotmail.com\n")
    fsortie.write ("// =============================//\n")
    fsortie.write ("\n")
    print p
    for i in p:
        fsortie.write(i + "\n")

def lireconfig():
    config = []
    fconfig.readlines
    for line in fconfig:
            config.append(line.strip()) ,
    print "param extraits \n" + str(config)
    return config
def liremission(config):
    selection = []
    fmission.readlines
    for line in fmission:
        for chaine in config:            
            if line.find(chaine) > -1:
                selection.append(line.strip()),
    #print "selection \n" + str(selection)
    return selection
    
def affine(selection):
    top=False
    liste=[]
    for i in selection:
        chaine = str("text=")
        if i.find(chaine) > -1:
          # print i, top
           top=True
           liste.append(i)
        if i.find("vehicle") > -1:
            if top==True:
                liste.append(i)
        if i.find("azimut") > -1:
            if top==True:
                liste.append(i)
        if i.find("position[]") > -1:
            if top==True:
                liste.append(i)
        if i.find("items") > -1:
            top=False 
    #print "liste \n" + str(liste)               
    return liste

def scriptsqf(p):
    lescript = []
    finvehicule=False
    #print "scriptsqf(p) \n" + str(p)
    for i in p:
        chaine = "vehicle="
        if i.find(chaine) > -1:
            letype = str(i).lstrip(chaine).rstrip(";")
        chaine = "azimut="
        if i.find(chaine) > -1:
            azimut = str(i).lstrip(chaine).rstrip(";")
        chaine = "position[]={"
        if i.find(chaine) > -1:
            laposition = i.lstrip(chaine).rstrip("};") + ",0"
            liste = laposition.split(",")
            liste.pop(1)
            laposition = str(liste).lstrip("[").rstrip("]").replace("'", "")
            finvehicule=True
        
        if finvehicule:
            result = "_pos = [" + laposition + "];"
            lescript.append(result)
            result = "_veh = " + letype + " createVehicle _pos;"
            lescript.append(result)
            result = "_veh setDir " + azimut + ";"
            lescript.append(result)
            result = "_veh setPos _pos;"
            lescript.append(result)
            lescript.append("")
            finvehicule=False
    return lescript

#### dï¿½but    
print "DEBUT"                
fsortie = open ("F:\zas\script.sqf","w")
fconfig = open ("F:\zas\config.txt","r")
fmission = open ("F:\zas\mission.sqm","r")


config = lireconfig()

selection = liremission(config)
selection.reverse()
laliste = affine(selection)
lescript = scriptsqf(laliste)
ecrire(lescript)

fmission.close
fconfig.close
fsortie.close

print "FIN"
